map $status $loggable {
	~^[23]  0;
	default 1;
}
# access_log /path/to/access.log combined if=$loggable;

# === PLAINTEXT servers ===

server {
	listen              80;
	server_name         www.alexey.shpakovsky.ru;
	return              301 'http://alexey.shpakovsky.ru$request_uri';
}

server {
	listen              80;
	server_name         alexey.shpakovsky.ru;
	access_log          /data/logs/alexey.log.gz combined gzip if=$loggable;
	error_log           /data/logs/alexey.err.log notice;
	root                /data/public/alexey.shpakovsky.ru;
	location /logshow/ { proxy_pass http://127.0.0.1:8003/; }
	location /en/spam-emails.html    { ssi on; }
	location /en/login-attempts.html { ssi on; }
	location /.git/    { return 301 'https://github.com/Lex-2008/Lex-2008.github.io.git/$request_uri'; }
	location /private/ { return 403 Forbidden; }
}

# === main server ===

server {
	listen              80;
	listen              443 ssl;
	server_name         shpakovsky.ru;
	access_log          /data/logs/shpakovsky.log.gz combined gzip;
	error_log           /data/logs/shpakovsky.err.log notice;
	location /robots.txt          { return 200 'User-agent: *\nDisallow: /'; }
	location /.well-known/carddav { return 301 https://baikal.shpakovsky.ru/dav.php; }
	location /.well-known/caldav  { return 301 https://baikal.shpakovsky.ru/dav.php; }
	location /baikal/             { return 301 https://baikal.shpakovsky.ru/dav.php; }
	location = /       { return 204; }
	location /         { return 404; }
}

